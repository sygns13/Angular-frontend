<div class="p-grid" *ngIf="vistaCarga">
  <div class="p-col-12" style="text-align: center">
    <p-progressSpinner
      [style]="{ width: '100px', height: '100px' }"
      styleClass="custom-spinner"
      strokeWidth="8"
      fill="#EEEEEE"
      animationDuration=".5s"
    ></p-progressSpinner>
  </div>
</div>

<p-toast position="top-center"></p-toast>

<div class="p-grid" *ngIf="verFrmAlmacen">
  <div class="p-col-12">
    <div class="card p-shadow-10">
      <h5>Registro de Ventas</h5>
      <div class="p-fluid box">
        <div class="p-field p-grid">
          <label for="almacen" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0"
            >Seleccione Local Principal o Sucursal:</label
          >
          <div class="p-col-12 p-md-10">
            <span class="p-float-label">
              <p-dropdown
                #tinputclsTipoProducto
                inputId="almacen"
                [options]="almacens"
                [(ngModel)]="clsAlmacen"
                optionLabel="name"
                [autoDisplayFirst]="false"
                [style]="{ height: '31px' }"
                [filter]="true"
              ></p-dropdown>
              <label>Seleccione</label>
            </span>
          </div>
        </div>
      </div>
      <br />
      <br />
      <button
        (click)="seleccionarLocal()"
        pButton
        pRipple
        type="button"
        icon="pi pi-plus"
        label="Seleccionar"
        class="p-button-raised p-button-info p-mr-2 p-mb-2"
      ></button>
    </div>
  </div>
</div>

<div class="p-grid" *ngIf="verFrmVenta">
  <div class="p-col-12">
    <div class="card p-shadow-10">
      <h4>Registro de Ventas</h4>
      <div class="p-fluid box">
        <!-- <div class="p-fluid">
                    <blockquote>Aquí puede registrar los clientes que desee definir, los clientes son necesarios para el registro de venta ya que tienen que seleccionarse para poder registrar las ventas</blockquote>
                </div>
                <br>
        
                <button (click)="nuevo()" pButton pRipple type="button" icon="pi pi-plus" label="Agregar Nuevo Cliente" class="p-button-raised p-button-info p-mr-2 p-mb-2"></button> -->

        <div class="p-field p-grid">
          <label for="local" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            ><b>Local o Sucursal:</b></label
          >
          <div class="p-col-12 p-md-10">
            <span
              class="person-tag teal-bgcolor p-p-1 fs-small"
              style="
                color: #f7f7f7;
                font-weight: 500;
                font-size: 15px !important;
              "
              >{{ venta.almacen.nombre }}</span
            >
          </div>
        </div>

        <div class="p-field p-grid">
          <label for="numVenta" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0"
            ><b>N° de Venta: {{ venta.numeroVenta }}</b></label
          >
          <label for="nombreCliente" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            ><b>Cliente:</b></label
          >
          <div class="p-col-12 p-md-7">
            <input
              id="nombreCliente"
              type="text"
              pInputText
              [(ngModel)]="venta.cliente.nombre"
              #inputNombreCliente
              [readonly]="true"
            />
          </div>
          <div class="p-col-12 p-md-2">
            <button
              (click)="buscarCliente()"
              pButton
              pRipple
              type="button"
              icon="pi pi-search"
              label="Buscar Cliente"
              class="p-button-raised p-button-info"
            ></button>
          </div>
        </div>

        <div class="p-field p-grid">
            <div class="p-col-12 p-md-2">
            </div>
          <label for="documentoCliente" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            ><b>N° de Documento:</b></label
          >
          <div class="p-col-12 p-md-3">
            <input
              id="documentoCliente"
              type="text"
              pInputText
              [(ngModel)]="venta.cliente.documento"
              #inputDocumentoCliente
              [readonly]="true"
            />
          </div>
          <div
            class="p-col-12 p-md-2"
            style="text-align: center; padding-top: 6px; padding-bottom: 6px"
          >
            <span 
              *ngIf="nombreDocIdentidad != null && nombreDocIdentidad.length > 0"
              class="person-tag pink-bgcolor p-p-1 fs-small"
              style="
                color: #f7f7f7;
                font-weight: 500;
                min-height: 100%;
                display: inline-flex;
                align-items: center;
                font-size: 15px !important;
              "
              >{{ nombreDocIdentidad }}</span
            >
          </div>
          <div
            class="p-col-12 p-md-4"
            style="padding-top: 6px; padding-bottom: 6px"
          >
            <div class="p-inputgroup">
              <button
                pButton
                pRipple
                type="button"
                label="Buscar Cliente"
                (click)="buscarDocCliente()"
                style="width: 150px"
              ></button>
              <span class="p-float-label">
                <input
                  type="text"
                  pInputText
                  [(ngModel)]="txtBuscarDocCliente"
                  (keyup.enter)="buscarDocCliente()"
                  #inputBuscarDocCliente
                />
                <label>Documento de Identidad</label>
              </span>
            </div>
          </div>
        </div>

        <hr />

        <div class="p-field p-grid">
          <label for="codigoProducto" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0"
            ><b>Agregar Productos por Código</b></label
          >
          <div class="p-col-12 p-md-4">
            <input
              id="codigoProducto"
              type="text"
              pInputText
              [(ngModel)]="codigoProducto"
              #inputcodigoProducto
              placeholder="Inserte el código y enter"
            />
          </div>

          <div
            class="p-col-12 p-md-6"
          >
            <div class="p-inputgroup">
              <button
                pButton
                pRipple
                type="button"
                label="Buscar Producto"
                (click)="buscarProducto()"
                style="width: 150px"
              ></button>
              <span class="p-float-label">
                <input
                  type="text"
                  pInputText
                  [(ngModel)]="txtBuscarProducto"
                  (keyup.enter)="buscarProducto()"
                />
                <label>Texto de búsqueda de producto</label>
              </span>
            </div>
          </div>
        </div>

      </div>

      <h5>Listado de Productos a la Venta</h5>

      <p-table
        [value]="detalleVentas"
        [resizableColumns]="true"
        [paginator]="true"
        [rows]="rows"
        [showCurrentPageReport]="true"
        currentPageReportTemplate="Mostrando {first} a {last} de {totalRecords} registros"
        [rowsPerPageOptions]="[10, 25, 50]"
        styleClass="p-datatable-gridlines"
        responsiveLayout="scroll"
        [style]="{ width: '100%', 'padding-right': '0px!important' }"
      >
        <ng-template pTemplate="colgroup" let-columns>
          <!-- <colgroup>
                    <col style="width:60px;">
                    <col style="width:60px;">
                    <col style="width:100px;">
                    <col style="width:250px;">
                    <col style="width:100px;">
                    <col style="width:150px;">
                    <col style="width:80px;">
                    <col style="width:80px;">
                    <col style="width:100px;">
                    <col style="width:100px;">
                    <col style="width:100px;">
                    <col style="width:100px;">
                    <col style="width:100px;">
                    <col style="width:100px;">
                </colgroup> -->
        </ng-template>

        <ng-template pTemplate="header">
          <tr>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Gestión
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              N°
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Código
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Descripción del Producto
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Unidad
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Lote
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Fecha de Vencimiento
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Cantidad
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Precio Unitario
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Descuento
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              IGV
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              ISC
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              Importe de Venta
            </th>
            <th
              pResizableColumn
              style="
                background-color: rgb(80, 148, 216);
                border: 1px solid rgb(221, 221, 221);
                color: white;
              "
            >
              ICBPER
            </th>
          </tr>
        </ng-template>

        <ng-template pTemplate="body" let-servicioFila let-rowIndex="rowIndex">
          <tr>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 1px;
                text-align: center;
              "
            >
              <button
                (click)="editar(servicioFila, $event)"
                pButton
                pRipple
                type="button"
                icon="pi pi-pencil"
                class="p-button-rounded p-button-success p-mr-2 p-mb-2"
                pTooltip="Editar Producto"
                tooltipPosition="top"
                style="height: 2rem; width: 2rem"
              ></button>
              <button
                *ngIf="servicioFila.borrado === 0"
                (click)="eliminar(servicioFila, $event)"
                pButton
                pRipple
                type="button"
                icon="pi pi-trash"
                class="p-button-rounded p-button-danger p-mr-2 p-mb-2"
                pTooltip="Eliminar Producto"
                tooltipPosition="top"
                style="height: 2rem; width: 2rem"
              ></button>
            </td>

            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ rowIndex }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.codigo }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.producto }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.unidad }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.lote }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.fechaVencimiento }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.cantidad }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.precioUnidad | currency : "PEN" : "S/." }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.descuento | currency : "PEN" : "S/." }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.igv | currency : "PEN" : "S/." }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.isc | currency : "PEN" : "S/." }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.importeVenta | currency : "PEN" : "S/." }}
            </td>
            <td
              style="
                border: 1px solid rgb(221, 221, 221);
                font-size: 1rem;
                padding: 5px;
              "
            >
              {{ servicioFila.icbper | currency : "PEN" : "S/." }}
            </td>
          </tr>
        </ng-template>
      </p-table>
      <br />

      <div class="p-fluid box">
        <div class="p-field p-grid" style="margin-bottom: 0px">
          <div class="p-col-12 p-md-9"></div>
          <label for="OpGravada" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            >Op. Gravada:</label
          >
          <div class="p-col-12 p-md-2">
            <input
              id="OpGravada"
              type="text"
              pInputText
              [(ngModel)]="OpGravada"
              #inputOpGravada
              [disabled]="true"
            />
          </div>
        </div>
        <div class="p-field p-grid" style="margin-bottom: 0px">
          <div class="p-col-12 p-md-9"></div>
          <label for="OpExonerada" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            >Op. Exonerada:</label
          >
          <div class="p-col-12 p-md-2">
            <input
              id="OpExonerada"
              type="text"
              pInputText
              [(ngModel)]="OpExonerada"
              #inputOpExonerada
              [disabled]="true"
            />
          </div>
        </div>
        <div class="p-field p-grid" style="margin-bottom: 0px">
          <div class="p-col-12 p-md-9"></div>
          <label for="OpInafecta" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            >Op. Inafecta:</label
          >
          <div class="p-col-12 p-md-2">
            <input
              id="OpInafecta"
              type="text"
              pInputText
              [(ngModel)]="OpInafecta"
              #inputOpInafecta
              [disabled]="true"
            />
          </div>
        </div>
        <div class="p-field p-grid" style="margin-bottom: 0px">
          <div class="p-col-12 p-md-9"></div>
          <label for="TotalISC" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            >ISC:</label
          >
          <div class="p-col-12 p-md-2">
            <input
              id="TotalISC"
              type="text"
              pInputText
              [(ngModel)]="TotalISC"
              #inputTotalISC
              [disabled]="true"
            />
          </div>
        </div>
        <div class="p-field p-grid" style="margin-bottom: 0px">
          <div class="p-col-12 p-md-9"></div>
          <label for="TotalIGV" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            >IGV:</label
          >
          <div class="p-col-12 p-md-2">
            <input
              id="TotalIGV"
              type="text"
              pInputText
              [(ngModel)]="TotalIGV"
              #inputTotalIGV
              [disabled]="true"
            />
          </div>
        </div>
        <div class="p-field p-grid" style="margin-bottom: 0px">
          <div class="p-col-12 p-md-9"></div>
          <label for="TotalICBPER" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            >ICBPER:</label
          >
          <div class="p-col-12 p-md-2">
            <input
              id="TotalICBPER"
              type="text"
              pInputText
              [(ngModel)]="TotalICBPER"
              #inputTotalICBPER
              [disabled]="true"
            />
          </div>
        </div>
        <div class="p-field p-grid" style="margin-bottom: 0px">
          <div class="p-col-12 p-md-9"></div>
          <label for="ImporteTotal" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
            ><b>Importe Total:</b></label
          >
          <div class="p-col-12 p-md-2">
            <input
              id="ImporteTotal"
              type="text"
              pInputText
              [(ngModel)]="ImporteTotal"
              #inputImporteTotal
              [disabled]="true"
            />
          </div>
        </div>
      </div>

      <br />

      <button
        (click)="cobrarVenta()"
        pButton
        pRipple
        type="button"
        icon="pi pi-money-bill"
        label="Cobrar Venta"
        class="p-button-raised p-mr-2 p-mb-2"
      ></button>
      <button
        (click)="nuevaVenta()"
        pButton
        pRipple
        type="button"
        icon="pi pi-plus"
        label="Nueva Venta"
        class="p-button-raised p-button-success p-mr-2 p-mb-2"
      ></button>
      <button
        (click)="cancelarVenta($event)"
        pButton
        pRipple
        type="button"
        icon="pi pi-times-circle"
        label="Resetear Venta"
        class="p-button-raised p-button-warning p-mr-2 p-mb-2"
      ></button>
      <button
        (click)="cerrarVenta($event)"
        pButton
        pRipple
        type="button"
        icon="pi pi-sign-out"
        label="Cerrar y Elegir Local"
        class="p-button-raised p-button-danger p-mr-2 p-mb-2"
      ></button>
    </div>
  </div>

  <p-confirmDialog
    header="Confirmación"
    #cd
    key="confirmDialog"
    icon="pi pi-exclamation-triangle"
    message="¿Está seguro de Registrar?"
    [style]="{ width: '425px' }"
    acceptButtonStyleClass="p-button-text"
    rejectButtonStyleClass="p-button-text"
  >
    <p-footer>
      <button
        type="button"
        pButton
        icon="pi pi-times"
        label="No"
        (click)="cd.reject()"
      ></button>
      <button
        type="button"
        pButton
        icon="pi pi-check"
        label="Si, Aceptar"
        (click)="cd.accept()"
      ></button>
    </p-footer>
  </p-confirmDialog>
</div>

<p-dialog header="Seleccionar Cliente" [(visible)]="displayClient" [modal]="true" [style]="{ width: '70vw' }" [draggable]="false" [resizable]="false">
    <div class="p-col-12">
            <div class="p-mb-3" style="margin-top: 5px;">
                <div class="p-inputgroup">
                    <button pButton pRipple type="button" label="Buscar" (click)="buscarClientes()"></button>
                    <span class="p-float-label" style="margin-right: 10px;" >
                        <input type="text" pInputText [(ngModel)]="txtBuscarCliente" (keyup.enter)="buscarClientes()" #inputBuscar/>
                        <label>Palabra Clave</label>
                    </span>
                    <button (click)="nuevoCliente()" pButton pRipple type="button" label="Nuevo Cliente" class="p-button-info" icon="pi pi-plus" style="min-width: 130px;"></button>
                </div>
            </div>


            <div class="p-col-12" *ngIf="vistaRegistroCliente">
                <div class="card  p-shadow-10">
                    <h5>{{tipoFrmCliente}}</h5>
                    <div class="p-fluid box">
        
        
                        <div class="p-field p-grid">
                            <label for="tipoDocumento" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0">Tipo de Documento de Identidad</label>
                            <div class="p-col-12 p-md-2">
                                <span class="p-float-label">
                                    <p-dropdown #tinputclsTipoDocumentoCliente inputId="tipoDocumentoCliente" [options]="tipoDocumentosCliente" [(ngModel)]="clsTipoDocumentoCliente" optionLabel="name" [autoDisplayFirst]="false" [style]="{'height':'31px'}" [filter]="true"></p-dropdown>
                                        <label>Seleccione</label>
                                </span>
                            </div>
                            <label for="codigoCliente" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0">Documento de Identidad</label>
                            <div class="p-col-12 p-md-2">
                                <input id="codigoCliente" type="text" pInputText [(ngModel)]="documentoCliente" #inputCodigoCliente maxLength="45">
                            </div>
                        </div>
        
                        <div class="p-field p-grid">
                            <label for="nombreCliente" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0">Nombre del Cliente</label>
                            <div class="p-col-12 p-md-10">
                                <input id="nombreCliente" type="text" pInputText [(ngModel)]="nombreCliente" #inputNombreClienteReg maxLength="500">
                            </div>
                        </div>
        
                        <div class="p-field p-grid">
                            <label for="direccionCliente" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0">Dirección</label>
                            <div class="p-col-12 p-md-10">
                                <input id="direccionCliente" type="text" pInputText [(ngModel)]="direccionCliente" #inputDireccionCliente maxLength="500">
                            </div>
                        </div>
        
                        <div class="p-field p-grid">
                            <label for="telefonoCliente" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0">Telefono</label>
                            <div class="p-col-12 p-md-10">
                                <input id="telefonoCliente" type="text" pInputText [(ngModel)]="telefonoCliente" #inputTelefonoCliente maxLength="25">
                            </div>
                        </div>
        
                        <div class="p-field p-grid">
                            <label for="correo1Cliente" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0">Correo Electrónico 1</label>
                            <div class="p-col-12 p-md-10">
                                <input id="correo1Cliente" type="text" pInputText [(ngModel)]="correo1Cliente" #inputCorreo1Cliente maxLength="1000">
                            </div>
                        </div>
        
                        <div class="p-field p-grid">
                            <label for="correo2Cliente" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0">Correo Electrónico 2</label>
                            <div class="p-col-12 p-md-10">
                                <input id="correo2Cliente" type="text" pInputText [(ngModel)]="correo2Cliente" #inputCorreo2Cliente maxLength="1000">
                            </div>
                        </div>
        
        
                    </div>
            
                    <br>
                    <button *ngIf="vistaBotonRegistroCliente" (click)="registrarCliente($event)" pButton pRipple type="button" icon="pi pi-save" label="Registrar" class="p-button-raised p-mr-2 p-mb-2"></button>
                    <button *ngIf="vistaBotonRegistroCliente"  (click)="cancelarCliente()" pButton pRipple type="button" icon="pi pi-times-circle" label="Cancelar" class="p-button-raised p-button-warning p-mr-2 p-mb-2"></button>
                    <!-- <button *ngIf="vistaBotonEdicionCliente" (click)="modificarCliente($event)" pButton pRipple type="button" icon="pi pi-save" label="Editar" class="p-button-raised p-button-success p-mr-2 p-mb-2"></button> -->
                    <button (click)="cerrarCliente()" pButton pRipple type="button" icon="pi pi-times" label="Cerrar" class="p-button-raised p-button-danger p-mr-2 p-mb-2"></button>
                </div>
            </div>
            

          <p-table [value]="clientes" [resizableColumns]="true" [paginator]="true" [rows]="rowsClientes" [showCurrentPageReport]="true" [lazy]="true"  [(first)]="firstClientes"  [(totalRecords)]="totalRecordsClientes" [loading]="loadingClientes" (onLazyLoad)="loadDataClientes($event)"
            currentPageReportTemplate="Mostrando {{firstClientes}} a {{lastClientes}} de {{totalRecordsClientes}} registros" [rowsPerPageOptions]="[10]" styleClass="p-datatable-gridlines" responsiveLayout="scroll" [style]="{width:'100%', 'padding-right': '0px!important'}" 
            selectionMode="single" [(selection)]="selectedClient" dataKey="id">


          <ng-template pTemplate="header">
              <tr>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">N°</th>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Cliente</th>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Tipo de Documento de Identidad</th>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Documento de Identidad</th>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Dirección</th>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Teléfono</th>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Correo Electrónico 1</th>
                  <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Correo Electrónico 2</th>
              </tr>
          </ng-template>
          <ng-template pTemplate="body" let-cliente let-rowIndex="rowIndex" >
              <tr [pSelectableRow]="cliente" (dblclick)="aceptarCliente(cliente)">
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{rowIndex+1}}</td>
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{cliente.nombre}}</td>
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{cliente.tipoDocumento.descripcion}}</td>
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{cliente.documento}}</td>
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{cliente.direccion}}</td>
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{cliente.telefono}}</td>
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{cliente.correo1}}</td>
                  <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{cliente.correo2}}</td>
              </tr>
          </ng-template>
      </p-table>
      <div class="p-mb-3"></div>
      </div>
  <p-footer>
      <!-- <button pButton pRipple type="button" icon="pi pi-check" (click)="displayClient=false" label="Yes" class="p-button-text"></button> -->
      <button (click)="displayClient=false" pButton pRipple type="button" icon="pi pi-times" label="Cerrar" class="p-button-raised p-button-danger"></button>
      <!-- <button pButton pRipple type="button" icon="pi pi-times" (click)="displayClient=false" label="No" class="p-button-text"></button> -->
  </p-footer>
</p-dialog>












<p-dialog header="Buscar Productos Para Ventas" [(visible)]="displayProductsToVentas" [modal]="true" [style]="{ 'min-height':'500px', width: '70vw' }" [draggable]="false" [resizable]="false">
    <div class="p-col-12">
            <!-- <div class="p-mb-3" style="margin-top: 5px;"> -->
            <div class="p-field p-grid" style="margin-top: 5px;">
              <div class="p-col-12 p-md-5" >
                <div class="p-inputgroup">
                    <button pButton pRipple type="button" label="Buscar" (click)="buscarProductos()"></button>
                    <span class="p-float-label" style="margin-right: 10px;" >
                        <input type="text" pInputText [(ngModel)]="txtBuscarProducto" (keyup.enter)="buscarProductos()" #inputBuscarProductos/>
                        <label>Palabra Clave</label>
                    </span>
                    <!-- <button (click)="nuevoCliente()" pButton pRipple type="button" label="Nuevo Cliente" class="p-button-info" icon="pi pi-plus" style="min-width: 130px;"></button> -->
                </div>
            </div>

            
              <label for="unidad" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Unidades</label>
              <div class="p-col-12 p-md-2">
                  <span class="p-float-label">
                      <p-dropdown #inputclsUnidad inputId="unidad" [options]="unidads" [(ngModel)]="clsUnidad" optionLabel="name" [autoDisplayFirst]="false" [style]="{'height':'40px', 'width':'100%'}" [filter]="true" (onChange)="buscarProductos()"></p-dropdown>
                          <label>Seleccione</label>
                  </span>
              </div>
          </div>

<!-- [(selection)]="selectedProductVenta" -->

      <p-table [value]="productosVentas" [resizableColumns]="true" [paginator]="true" [rows]="rowsProductosToVentas" [showCurrentPageReport]="true" [lazy]="true"  [(first)]="firstProductosToVentas"  [(totalRecords)]="totalRecordsProductosToVentas" [loading]="loadingProductosToVentas" (onLazyLoad)="loadDataProductosToVentas($event)"
            currentPageReportTemplate="Mostrando {{firstProductosToVentas}} a {{lastProductosToVentas}} de {{totalRecordsProductosToVentas}} registros" [rowsPerPageOptions]="[10]" styleClass="p-datatable-gridlines" responsiveLayout="scroll" [style]="{width:'100%', 'padding-right': '0px!important'}" 
            dataKey="producto.id" selectionMode="single" >


          <ng-template pTemplate="header">
              <tr>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">N°</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Código</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Producto</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Tipo de Producto</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Composición</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Presentación</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Marca</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Unidad</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Precio de Venta</th>
                <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Ubicación</th>
                  <!-- <th pResizableColumn style="background-color: rgb(80, 148, 216); border: 1px solid rgb(221, 221, 221);  color:white;">Gestión</th> -->
              </tr>
          </ng-template>
          <ng-template pTemplate="body" let-registro let-rowIndex="rowIndex" >
              <tr [pSelectableRow]="registro" (dblclick)="aceptarProducto(registro)">
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{rowIndex+1}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.detalleUnidadProducto.codigoUnidad}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.producto.nombre}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.producto.tipoProducto.tipo}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.producto.composicion}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.producto.presentacion.presentacion}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.producto.marca.nombre}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.detalleUnidadProducto.unidad.nombre}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.detalleUnidadProducto.precio | currency:'PEN':'S/.'}}</td>
                <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 5px;">{{registro.producto.ubicacion}}</td>

                  <!-- <td style="border: 1px solid rgb(221, 221, 221); font-size: 1rem; padding: 1px; text-align: center;">
  
                      <button (click)="editar(cliente, $event)" pButton pRipple type="button" icon="pi pi-pencil" class="p-button-rounded p-button-success p-mr-2 p-mb-2" pTooltip="Editar Cliente" tooltipPosition="top" style="height: 2rem; width: 2rem;"></button>

                      <button *ngIf="cliente.borrado === 0" (click)="eliminar(cliente , $event)" pButton pRipple type="button" icon="pi pi-trash" class="p-button-rounded p-button-danger p-mr-2 p-mb-2" pTooltip="Eliminar Cliente" tooltipPosition="top" style="height: 2rem; width: 2rem;"></button>
                      
                  </td> -->
              </tr>
          </ng-template>
      </p-table>





      <div class="p-mb-3"></div>
      </div>
  <p-footer>
      <!-- <button pButton pRipple type="button" icon="pi pi-check" (click)="displayProductsToVentas=false" label="Yes" class="p-button-text"></button> -->
      <button (click)="displayProductsToVentas=false" pButton pRipple type="button" icon="pi pi-times" label="Cerrar" class="p-button-raised p-button-danger"></button>
      <!-- <button pButton pRipple type="button" icon="pi pi-times" (click)="displayProductsToVentas=false" label="No" class="p-button-text"></button> -->
  </p-footer>
</p-dialog>










<p-dialog header="Agregar Producto" [(visible)]="displayAddProductsLotes" [modal]="true" [style]="{ 'min-height':'485px', 'width': '80vw' }" [draggable]="false" [resizable]="false">
  <div class="p-col-12">
          <!-- <div class="p-mb-3" style="margin-top: 5px;"> -->

          <div class="p-field p-grid">
            <label for="local" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
              ><b>Producto:</b></label
            >
            <div class="p-col-12 p-md-3" *ngIf="selectedProductVenta != null">
              <span
                class="person-tag teal-bgcolor p-p-1 fs-small"
                style="
                  color: #f7f7f7;
                  font-weight: 500;
                  font-size: 15px !important;
                "
                >{{ selectedProductVenta.producto.presentacion.presentacion }} {{ selectedProductVenta.producto.nombre }} {{ selectedProductVenta.producto.marca.nombre }}</span
              >
            </div>

            <label for="local" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0"
              ><b>Unidad de Empaque:</b></label
            >
            <div class="p-col-12 p-md-2" *ngIf="selectedProductVenta != null">
              <span
                class="person-tag indigo-bgcolor p-p-1 fs-small"
                style="
                  color: #f7f7f7;
                  font-weight: 500;
                  font-size: 15px !important;
                "
                >{{ selectedProductVenta.detalleUnidadProducto.unidad.nombre }}</span
              >
            </div>

            <label for="local" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0"
              ><b>N° de Items de Empaque:</b></label
            >
            <div class="p-col-12 p-md-2" *ngIf="selectedProductVenta != null">
              <span
              class="person-tag indigo-bgcolor p-p-1 fs-small"
                style="
                  color: #f7f7f7;
                  font-weight: 500;
                  font-size: 15px !important;
                "
                >{{ selectedProductVenta.detalleUnidadProducto.unidad.cantidad }}</span
              >
            </div>
          </div>



        <div class="p-field p-grid" style="margin-top: 35px;">
            <label for="lote" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Lote</label>
            <div class="p-col-12 p-md-2">
                <span class="p-float-label">
                    <p-dropdown #inputclsLote inputId="lote" [options]="lotesProducto" [(ngModel)]="clsLote" optionLabel="name" [autoDisplayFirst]="false" [style]="{'height':'40px', 'width':'100%'}" [filter]="true" (onChange)="cambioLotes()"></p-dropdown>
                        <label>Seleccione</label>
                </span>
            </div>

            <label for="fecha_vencimiento" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">F. de Vencimiento</label>
            <div class="p-col-12 p-md-2">
              <input
                id="fecha_vencimiento"
                type="text"
                pInputText
                [(ngModel)]="fechaVencimiento"
                #inputFechaVencimiento
                [readonly]="true"
              />
            </div>

            <label for="cant_lote" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Items x Empaque Disponibles</label>
            <div class="p-col-12 p-md-2">
              <input
                id="cant_lote"
                type="text"
                pInputText
                [(ngModel)]="cantLote"
                #inputCantidadLote
                [readonly]="true"
              />
            </div>

            <label for="cant_unit_lote" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Items x Unidades Disponibles</label>
            <div class="p-col-12 p-md-2">
              <input
                id="cant_unit_lote"
                type="text"
                pInputText
                [(ngModel)]="cantUnitLote"
                #inputCantidadUnitariaLote
                [readonly]="true"
              />
            </div>
        </div>


        <hr>

        <div class="p-field p-grid" style="margin-top: 45px;">

          <label for="cant_producto" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Cantidad</label>
            <div class="p-col-12 p-md-2">
              <input
                id="cant_producto"
                type="text"
                pInputText
                [(ngModel)]="cantidadProductoLotes"
                #inputcantidadProductoLotes
                (change)="calcularPrecios($event)"
              />
            </div>

          <label for="descuento_producto" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Descuento</label>
            <div class="p-col-12 p-md-2">

              <div class="p-inputgroup">

                <span class="p-float-label" style="width: 70%;">
                    <p-dropdown (onChange)="changeTipoDescuento()" inputId="descuento_producto" [options]="tiposDescuento" [(ngModel)]="clsTiposDescuento" optionLabel="name" [autoDisplayFirst]="true" [style]="{'height':'40px', 'width': '100%'}" #inputTiposDescuento ></p-dropdown>
                        <label>Seleccione</label>
                </span>
                <span class="p-float-label">
                  <input
                    id="cant_descuento"
                    type="text"
                    pInputText
                    [(ngModel)]="cantidadDescuento"
                    #inputcantidadDescuento
                    (change)="calcularPrecios($event)"
                    
                  />
                </span>
              </div>
            </div>

            <label for="precioUnitario" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Precio Unitario</label>
            <div class="p-col-12 p-md-2">
              <input
                id="precioUnitario"
                type="text"
                pInputText
                [(ngModel)]="precioUnitario"
                #inputPrecioUnitario
                [readonly]="true"
              />
            </div>

            <label for="precioTotal" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Precio Total</label>
            <div class="p-col-12 p-md-1">
              <input
                id="precioTotal"
                type="text"
                pInputText
                [(ngModel)]="precioTotal"
                #inputPrecioTotal
                [readonly]="true"
              />
            </div>
        </div>






    <div class="p-mb-3" style="margin-top: 45px;"></div>

    <br>

    <button
        (click)="agregarProducto()"
        pButton
        pRipple
        type="button"
        icon="pi pi-check-square"
        label="Agregar Producto"
        class="p-button-raised p-mr-2 p-mb-2"
      ></button>
    </div>
  <p-footer>
      <!-- <button pButton pRipple type="button" icon="pi pi-check" (click)="displayProductsToVentas=false" label="Yes" class="p-button-text"></button> -->
      <button (click)="displayAddProductsLotes=false" pButton pRipple type="button" icon="pi pi-times" label="Cerrar" class="p-button-raised p-button-danger"></button>
      <!-- <button pButton pRipple type="button" icon="pi pi-times" (click)="displayProductsToVentas=false" label="No" class="p-button-text"></button> -->
  </p-footer>
</p-dialog>













<p-dialog header="Agregar Producto" [(visible)]="displayAddProductsNoLotes" [modal]="true" [style]="{'width': '80vw' }" [draggable]="false" [resizable]="false">
  <div class="p-col-12">
          <!-- <div class="p-mb-3" style="margin-top: 5px;"> -->

          <div class="p-field p-grid">
            <label for="local" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0"
              ><b>Producto:</b></label
            >
            <div class="p-col-12 p-md-3" *ngIf="selectedProductVenta != null">
              <span
                class="person-tag teal-bgcolor p-p-1 fs-small"
                style="
                  color: #f7f7f7;
                  font-weight: 500;
                  font-size: 15px !important;
                "
                >{{ selectedProductVenta.producto.presentacion.presentacion }} {{ selectedProductVenta.producto.nombre }} {{ selectedProductVenta.producto.marca.nombre }}</span
              >
            </div>

            <label for="local" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0"
              ><b>Unidad de Empaque:</b></label
            >
            <div class="p-col-12 p-md-2" *ngIf="selectedProductVenta != null">
              <span
                class="person-tag indigo-bgcolor p-p-1 fs-small"
                style="
                  color: #f7f7f7;
                  font-weight: 500;
                  font-size: 15px !important;
                "
                >{{ selectedProductVenta.detalleUnidadProducto.unidad.nombre }}</span
              >
            </div>

            <label for="local" class="p-col-12 p-mb-2 p-md-2 p-mb-md-0"
              ><b>N° de Items de Empaque:</b></label
            >
            <div class="p-col-12 p-md-2" *ngIf="selectedProductVenta != null">
              <span
              class="person-tag indigo-bgcolor p-p-1 fs-small"
                style="
                  color: #f7f7f7;
                  font-weight: 500;
                  font-size: 15px !important;
                "
                >{{ selectedProductVenta.detalleUnidadProducto.unidad.cantidad }}</span
              >
            </div>
          </div>



        <div class="p-field p-grid" style="margin-top: 35px;">

            

            <label for="cant_stock" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Items x Empaque Disponibles</label>
            <div class="p-col-12 p-md-2">
              <input
                id="cant_stock"
                type="text"
                pInputText
                [(ngModel)]="cantStock"
                #inputCantidadStock
                [readonly]="true"
              />
            </div>

            <label for="cant_unit_stock" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Items x Unidades Disponibles</label>
            <div class="p-col-12 p-md-2">
              <input
                id="cant_unit_stock"
                type="text"
                pInputText
                [(ngModel)]="cantUnitStock"
                #inputCantidadUnitariaStock
                [readonly]="true"
              />
            </div>
        </div>


        <hr>

        <div class="p-field p-grid" style="margin-top: 45px;">

          <label for="cant_producto_stock" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Cantidad</label>
            <div class="p-col-12 p-md-2">
              <input
                id="cant_producto_stock"
                type="text"
                pInputText
                [(ngModel)]="cantidadProductoStocks"
                #inputcantidadProductoStocks
                (change)="calcularPreciosStocks($event)"
              />
            </div>

          <label for="descuento_stock" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Descuento</label>
            <div class="p-col-12 p-md-2">

              <div class="p-inputgroup">

                <span class="p-float-label" style="width: 70%;">
                    <p-dropdown (onChange)="changeTipoDescuentoStock()" inputId="descuento_stock" [options]="tiposDescuento" [(ngModel)]="clsTiposDescuento" optionLabel="name" [autoDisplayFirst]="true" [style]="{'height':'40px', 'width': '100%'}" #inputTiposDescuento ></p-dropdown>
                        <label>Seleccione</label>
                </span>
                <span class="p-float-label">
                  <input
                    id="cant_descuento_stock"
                    type="text"
                    pInputText
                    [(ngModel)]="cantidadDescuentoStock"
                    #inputcantidadDescuentoStock
                    (change)="calcularPreciosStocks($event)"
                    
                  />
                </span>
              </div>
            </div>

            <label for="precioUnitario" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Precio Unitario</label>
            <div class="p-col-12 p-md-2">
              <input
                id="precioUnitario"
                type="text"
                pInputText
                [(ngModel)]="precioUnitario"
                #inputPrecioUnitario
                [readonly]="true"
              />
            </div>

            <label for="precioTotal" class="p-col-12 p-mb-1 p-md-1 p-mb-md-0">Precio Total</label>
            <div class="p-col-12 p-md-1">
              <input
                id="precioTotal"
                type="text"
                pInputText
                [(ngModel)]="precioTotal"
                #inputPrecioTotal
                [readonly]="true"
              />
            </div>
        </div>






    <div class="p-mb-3" style="margin-top: 45px;"></div>

    <br>

    <button
        (click)="agregarProductoStock()"
        pButton
        pRipple
        type="button"
        icon="pi pi-check-square"
        label="Agregar Producto"
        class="p-button-raised p-mr-2 p-mb-2"
      ></button>
    </div>
  <p-footer>
      <!-- <button pButton pRipple type="button" icon="pi pi-check" (click)="displayProductsToVentas=false" label="Yes" class="p-button-text"></button> -->
      <button (click)="displayAddProductsNoLotes=false" pButton pRipple type="button" icon="pi pi-times" label="Cerrar" class="p-button-raised p-button-danger"></button>
      <!-- <button pButton pRipple type="button" icon="pi pi-times" (click)="displayProductsToVentas=false" label="No" class="p-button-text"></button> -->
  </p-footer>
</p-dialog>